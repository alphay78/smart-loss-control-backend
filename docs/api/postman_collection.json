{
  "info": {
    "name": "Smart Loss Control API - Authentication",
    "description": "Complete authentication flow testing for Smart Loss Control Backend",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "owner_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "staff_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "qr_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "owner_phone",
      "value": "+254712345678",
      "type": "string"
    },
    {
      "key": "dev_otp",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health Check",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/health",
          "host": ["{{base_url}}"],
          "path": ["health"]
        },
        "description": "Check if server is running"
      }
    },
    {
      "name": "1. Owner Registration (Send OTP)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save dev_otp for next request",
              "if (pm.response.code === 201) {",
              "    var jsonData = pm.response.json();",
              "    if (jsonData.dev_otp) {",
              "        pm.collectionVariables.set('dev_otp', jsonData.dev_otp);",
              "        console.log('OTP saved: ' + jsonData.dev_otp);",
              "    }",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"full_name\": \"Amina Yusuf\",\n  \"shop_name\": \"Amina Ventures\",\n  \"phone\": \"{{owner_phone}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/register-owner",
          "host": ["{{base_url}}"],
          "path": ["auth", "register-owner"]
        },
        "description": "Register a new shop owner. In development mode, the OTP will be returned in the response."
      }
    },
    {
      "name": "2. Verify OTP (Owner Login)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save owner token",
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.collectionVariables.set('owner_token', jsonData.token);",
              "    console.log('Owner token saved');",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"phone\": \"{{owner_phone}}\",\n  \"otp\": \"{{dev_otp}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/verify-otp",
          "host": ["{{base_url}}"],
          "path": ["auth", "verify-otp"]
        },
        "description": "Verify OTP and get JWT token. Use the OTP from the previous request."
      }
    },
    {
      "name": "3. Generate QR Code (Owner Only)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save QR token",
              "if (pm.response.code === 201) {",
              "    var jsonData = pm.response.json();",
              "    pm.collectionVariables.set('qr_token', jsonData.qr_code.token);",
              "    console.log('QR token saved: ' + jsonData.qr_code.token);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{owner_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/auth/generate-qr",
          "host": ["{{base_url}}"],
          "path": ["auth", "generate-qr"]
        },
        "description": "Generate a QR code for staff onboarding. Expires in 30 minutes. Requires owner authentication."
      }
    },
    {
      "name": "4. Check QR Status",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/auth/qr-status/{{qr_token}}",
          "host": ["{{base_url}}"],
          "path": ["auth", "qr-status", "{{qr_token}}"]
        },
        "description": "Check QR code status with countdown timer. Public endpoint (no auth required)."
      }
    },
    {
      "name": "5. Link Staff Device (QR Onboarding)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"qr_token\": \"{{qr_token}}\",\n  \"device_id\": \"android-device-test-123\",\n  \"staff_name\": \"Chinedu Okafor\",\n  \"pin\": \"1234\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/staff/link",
          "host": ["{{base_url}}"],
          "path": ["auth", "staff", "link"]
        },
        "description": "Link a staff member's device using QR code. Creates staff account with name and PIN."
      }
    },
    {
      "name": "6. Staff Login (Name + PIN)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save staff token",
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.collectionVariables.set('staff_token', jsonData.token);",
              "    console.log('Staff token saved');",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"staff_name\": \"Chinedu Okafor\",\n  \"pin\": \"1234\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/login-pin",
          "host": ["{{base_url}}"],
          "path": ["auth", "login-pin"]
        },
        "description": "Staff login using name and 4-digit PIN. Returns JWT token."
      }
    },
    {
      "name": "7. Check SMS Status",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/auth/sms-status",
          "host": ["{{base_url}}"],
          "path": ["auth", "sms-status"]
        },
        "description": "Check SMS service configuration and mode (development/production)."
      }
    },
    {
      "name": "Test: Invalid OTP",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"phone\": \"{{owner_phone}}\",\n  \"otp\": \"999999\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/verify-otp",
          "host": ["{{base_url}}"],
          "path": ["auth", "verify-otp"]
        },
        "description": "Test with invalid OTP - should return 400 error"
      }
    },
    {
      "name": "Test: Wrong PIN",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"staff_name\": \"Chinedu Okafor\",\n  \"pin\": \"9999\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/login-pin",
          "host": ["{{base_url}}"],
          "path": ["auth", "login-pin"]
        },
        "description": "Test with wrong PIN - should return 401 error"
      }
    },
    {
      "name": "Test: Expired QR Code",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/auth/qr-status/invalid-token-12345",
          "host": ["{{base_url}}"],
          "path": ["auth", "qr-status", "invalid-token-12345"]
        },
        "description": "Test with invalid QR token - should return 404 error"
      }
    },
    {
      "name": "Test: Duplicate Staff Name",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"qr_token\": \"{{qr_token}}\",\n  \"device_id\": \"android-device-test-456\",\n  \"staff_name\": \"Chinedu Okafor\",\n  \"pin\": \"5678\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/staff/link",
          "host": ["{{base_url}}"],
          "path": ["auth", "staff", "link"]
        },
        "description": "Test with duplicate staff name - should return 400 error"
      }
    },
    {
      "name": "Test: Multi-Country Phones",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"full_name\": \"Kwame Mensah\",\n  \"shop_name\": \"Accra Oil Shop\",\n  \"phone\": \"+233201234567\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/register-owner",
          "host": ["{{base_url}}"],
          "path": ["auth", "register-owner"]
        },
        "description": "Test with Ghanaian phone number (+233)"
      }
    }
  ]
}
